<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CGL Mock Test Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-100 p-6">

  <div class="max-w-5xl mx-auto bg-white shadow-md p-6 rounded-lg">
    <h1 class="text-2xl font-bold text-center mb-6">CGL Mock Test Tracker</h1>

    <!-- Form -->
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
      <input id="name" type="text" placeholder="Name" class="border p-2 rounded" required>
      <input id="maths" type="number" placeholder="Maths" class="border p-2 rounded" required>
      <input id="english" type="number" placeholder="English" class="border p-2 rounded" required>
      <input id="reasoning" type="number" placeholder="Reasoning" class="border p-2 rounded" required>
      <input id="gk" type="number" placeholder="GK" class="border p-2 rounded" required>
    </div>
    <button onclick="submitData()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition mb-6">Submit</button>

    <!-- Filters -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
      <input type="date" id="filterDate" class="border p-2 rounded">
      <input type="text" id="filterName" placeholder="Filter by Name" class="border p-2 rounded">
    </div>

    <!-- Leaderboard -->
    <div class="overflow-x-auto bg-gray-50 p-4 rounded-lg shadow-inner">
      <table class="min-w-full border-collapse">
        <thead>
          <tr class="bg-blue-600 text-white">
            <th class="p-2 border">Rank</th>
            <th class="p-2 border">Name</th>
            <th class="p-2 border">Maths</th>
            <th class="p-2 border">English</th>
            <th class="p-2 border">Reasoning</th>
            <th class="p-2 border">GK</th>
            <th class="p-2 border">Total</th>
            <th class="p-2 border">Date</th>
          </tr>
        </thead>
        <tbody id="leaderboard"></tbody>
      </table>
    </div>

    <!-- Export PDF -->
    <div class="mt-6 text-center">
      <button id="exportPDF" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">ðŸ“„ Export as PDF</button>
    </div>
  </div>

  <!-- Hidden PDF Export Section -->
  <div id="pdfExportContent" class="hidden p-4 bg-white text-black">
    <div class="text-center mb-4">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/SSC_India_Logo.svg/2560px-SSC_India_Logo.svg.png" alt="Logo" style="max-height: 60px; margin: auto;" />
      <h2 class="text-2xl font-bold mt-2">CGL Mock Test Tracker</h2>
      <p id="pdfDate" class="text-sm"></p>
      <p id="pdfFilters" class="text-sm text-gray-600"></p>
    </div>
    <div id="pdfTable"></div>
  </div>

  <!-- Firebase + Logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDJPCpAZWgGLbE7Rsh4NaIPDPwNXNkaDlQ",
      authDomain: "scorecard-93031.firebaseapp.com",
      databaseURL: "https://scorecard-93031-default-rtdb.firebaseio.com",
      projectId: "scorecard-93031",
      storageBucket: "scorecard-93031.appspot.com",
      messagingSenderId: "397775062722",
      appId: "1:397775062722:web:929072a4ab23f6ed87dd5b",
      measurementId: "G-69BF1TLDYG"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function submitData() {
      const name = document.getElementById("name").value.trim();
      const maths = +document.getElementById("maths").value;
      const english = +document.getElementById("english").value;
      const reasoning = +document.getElementById("reasoning").value;
      const gk = +document.getElementById("gk").value;
      if (!name) return alert("Enter name!");

      const total = maths + english + reasoning + gk;
      const date = new Date().toISOString().split("T")[0];
      const id = Date.now();
      db.ref("scores/" + id).set({ name, maths, english, reasoning, gk, total, date });
    }

    function loadLeaderboard() {
      db.ref("scores").on("value", (snapshot) => {
        const data = snapshot.val();
        const tbody = document.getElementById("leaderboard");
        tbody.innerHTML = "";

        const filterDate = document.getElementById("filterDate").value;
        const filterName = document.getElementById("filterName").value.toLowerCase();

        let rows = [];
        for (let id in data) {
          const entry = data[id];
          if (filterDate && entry.date !== filterDate) continue;
          if (filterName && !entry.name.toLowerCase().includes(filterName)) continue;
          rows.push(entry);
        }

        rows.sort((a, b) => b.total - a.total);
        rows.forEach((row, i) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="border p-1 text-center">${i + 1}</td>
            <td class="border p-1">${row.name}</td>
            <td class="border p-1">${row.maths}</td>
            <td class="border p-1">${row.english}</td>
            <td class="border p-1">${row.reasoning}</td>
            <td class="border p-1">${row.gk}</td>
            <td class="border p-1 font-bold">${row.total}</td>
            <td class="border p-1 text-sm">${row.date}</td>
          `;
          tbody.appendChild(tr);
        });
      });
    }

    document.getElementById("filterDate").addEventListener("input", loadLeaderboard);
    document.getElementById("filterName").addEventListener("input", loadLeaderboard);
    loadLeaderboard();

    // Export to PDF
    document.getElementById("exportPDF").addEventListener("click", () => {
      const now = new Date().toLocaleString();
      const filterDateVal = document.getElementById("filterDate").value || "All Dates";
      const filterNameVal = document.getElementById("filterName").value || "All Names";

      document.getElementById("pdfDate").innerText = `Generated on: ${now}`;
      document.getElementById("pdfFilters").innerText = `Filters - Name: ${filterNameVal}, Date: ${filterDateVal}`;

      const currentTable = document.querySelector(".overflow-x-auto").innerHTML;
      document.getElementById("pdfTable").innerHTML = currentTable;

      const exportArea = document.getElementById("pdfExportContent");
      const opt = {
        margin: 0.5,
        filename: 'CGL_Mock_Leaderboard.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
      };
      html2pdf().set(opt).from(exportArea).save();
    });
  </script>
</body>
</html>
